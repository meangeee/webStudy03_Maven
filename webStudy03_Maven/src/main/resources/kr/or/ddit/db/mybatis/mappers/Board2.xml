<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.board.dao.IBoard2DAO">
	<sql id="searchFrag">
		<where>
			<if test="searchMap!=null">
				<if
					test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchMap.searchWord)">
					<choose>
						<when test="'title'.equals(searchMap.searchType)">
							INSTR(BO_TITLE, #{searchMap.searchWord}) > 0
						</when>
						<when test="'writer'.equals(searchMap.searchType)">
							INSTR(BO_WRITER, #{searchMap.searchWord}) > 0
						</when>
						<when test="'content'.equals(searchMap.searchType)">
							BO_CONTENT LIKE '%'||#{searchMap.searchWord}||'%'
						</when>
						<otherwise>
							INSTR(BO_TITLE, #{searchMap.searchWord}) > 0
							OR INSTR(BO_WRITER, #{searchMap.searchWord}) > 0
							OR BO_CONTENT LIKE '%'||#{searchMap.searchWord}||'%'
						</otherwise>
					</choose>
				</if>
			</if>
		</where>
	</sql>
	<select id="selectBoardCount" parameterType="PagingInfoVO"
		resultType="int">
		SELECT COUNT(*)
		FROM BOARD2
		<include refid="searchFrag" />
	</select>
	<select id="selectBoardList" parameterType="PagingInfoVO"
		resultType="Board2VO">
		SELECT B.*
		FROM(
		SELECT ROWNUM RNUM, A.*
		FROM(
		    	<![CDATA[
		        SELECT LEVEL,
		            BO_NO,    BOARD_TYPE,    
		            LPAD('&nbsp;', 6*(level-1), '&nbsp;') || BO_TITLE AS BO_TITLE,
		            BO_WRITER,   BO_HIT,	 BO_LIKE,
		            TO_CHAR(BO_DATE, 'YYYY-MM-DD HH:MI') BO_DATE       
		        FROM   BOARD2
		        ]]>
		<include refid="searchFrag" />
		START WITH BO_PARENT IS NULL
		CONNECT BY PRIOR BO_NO = BO_PARENT
		ORDER SIBLINGS BY BO_NO DESC
		) A
		) B
		WHERE RNUM BETWEEN #{startRow} AND #{endRow}
	</select>

	<resultMap type="Board2VO" id="boardMap" autoMapping="true">
      <id property="bo_no" column="BO_NO"/>
      <collection property="attatchList" ofType="Attatch2VO" autoMapping="false">
         <id property="bo_no" column="BO_NO" />
         
         
      </collection>
   </resultMap>
   
   <select id="selectBoard" parameterType="Board2VO" resultMap="boardMap">
        SELECT
             A.BO_NO,    BOARD_TYPE,    BO_TITLE,    BO_WRITER,
             TO_CHAR(BO_DATE,'YYYY-MM-DD HH:MI') BO_DATE,    BO_CONTENT,    BO_PASS,    BO_IP,
             BO_HIT,    BO_LIKE,  
               (select board_name from boardTYPE2 c
                WHERE C.BOARD_TYPE  =A.BOARD_TYPE) BOARD_NAME
             ,ATT_NO,ATT_FILENAME,
             ATT_MIME, ATT_FANCYSIZE
             ,ATT_DOWNCOUNT
         FROM
             board2 A LEfT OUTER JOIN ATTATCH2 B ON(A.BO_NO = B.BO_NO)
         WHERE A.bo_no = #{bo_no} 
                 
        
   </select>
   
  

	<update id="updateBoardHit" parameterType="Board2VO">
		UPDATE BOARD2
		SET BO HIT = BO HIT + 1
		WEHRE BO_NO = #{bo_no}
	</update>

<!-- 	<insert id="" parameterType=""> -->
<!-- 		<selectKey order="BEFORE" keyProperty="bo_no" resulType="int"> -->
		
<!-- 		</selectKey> -->
<!-- 		Insert into board2 -->
<!-- 		( -->
<!-- 		bo_parent -->
<!-- 		) -->
<!-- 		values( -->
<!-- 		#{bo_parent} -->
<!-- 		) -->

<!-- 	</insert> -->
</mapper>

